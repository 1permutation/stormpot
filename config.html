<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Configuration</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#_pool_size">Pool Size</a></li>
<li><a href="#_object_expiration">Object Expiration</a></li>
<li><a href="#_background_expiration_checking">Background Expiration Checking</a></li>
<li><a href="#_allocator_vs_reallocator">Allocator vs Reallocator</a></li>
<li><a href="#metrics-recorder">MetricsRecorder</a></li>
<li><a href="#_threadfactory">ThreadFactory</a></li>
<li><a href="#_precise_leak_detection">Precise Leak Detection</a></li>
<li><a href="#_complete_config_source">Complete Config Source</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stormpot has many configuration options, but only one is required:
You have to specify what <code>Allocator</code> or <code>Reallocator</code> implementation to use.
The rest of the configuration options are optional, though there are a couple you most likely want to tweak.</p>
</div>
<div class="sect2">
<h3 id="_pool_size">Pool Size</h3>
<div class="paragraph">
<p>The size of the pool is configured with <code>setSize</code>.
This configuration determines the maximum number of objects the pool should keep in circulation at any given time.
The default size is 10 objects.
Note that this is a maximum.
The pool will <em>never</em> have more than this many objects allocated at any given time.</p>
</div>
<div class="paragraph">
<p>As it happens, the current implementations will allocate objects until the pool is full, and then stop until objects expire and needs reallocating.
This effectively means that there&#8217;s no such thing as a low-water-mark in Stormpot.
It also means that, if you&#8217;ve done your capacity planning right, you will have fairly predictable latencies in claiming objects from the pool, since the given size is exactly the number of objects the pool will contain at any time.
On the other hand, it also means that if an object has expired, it will have to be deallocated before a replacement can be allocated.</p>
</div>
<div class="paragraph">
<p>It also means that you can&#8217;t mindlessly set this to some arbitrary high value and consider it done.
The pool will really allocate this many objects, expecting them to be in demand.
The upside to this is that if your application develops a fault where it claims objects uncontrollably, it will be prevented from allocating more objects than the system can handle.
For instance, if the pooled objects represent connections to a database, that database will be sheltered from such a rogue application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_object_expiration">Object Expiration</h3>
<div class="paragraph">
<p>Prior to claiming an object, Stormpot always checks if the object in question has expired.
What it means for an object to be "expired" depends on what objects we are talking about, what they are used for and what it means to pool them.
For instance, you might be pooling network connections that are closed by a firewall if they have been idle for too long, in which case it makes sense to have them reconnect before that happens.</p>
</div>
<div class="paragraph">
<p>It is the <code>Expiration</code> policy that decides whether or not an object has expired, and it is configured with <code>setExpiration</code>.
The default expiration policy is a <code>TimeSpreadExpiration</code> that expires objects after they&#8217;ve been circulating for somewhere between 8 to 10 minutes.
The <code>TimeSpreadExpiration</code> is pretty handy, because it spreads the expirations out over time.
This means that the objects in the pool don&#8217;t all expire at the same time.
This is an improvement over the simple <code>TimeExpiration</code>, because an object cannot be claimed once it has expired.</p>
</div>
<div class="paragraph">
<p>If all objects expire at the same time, it could temporarily leave the pool completely empty, until all the expired objects have been reallocated.
Such periods of "object drought" can lead to long stalls, aka. latencies in claiming objects from the pool, as the demand for objects is suddenly much higher than the availability.</p>
</div>
<div class="paragraph">
<p>It might also be the case that there is no reason for objects to expire.
In that case, a custom <code>Expiration</code> policy can be configured, that simply always returns <code>false</code> from its <code>hasExpired</code> method.</p>
</div>
<div class="sect3">
<h4 id="_custom_object_expiration">Custom Object Expiration</h4>
<div class="paragraph">
<p>You can do more advanced stuff with object expiration, though, than just choosing between <code>TimeSpreadExpiration</code> and <code>TimeExpiration</code>.
You can implement your own policy by implementing the <code>Expiration</code> interface.
Then return <code>true</code> from the <code>hasExpired</code> method, whenever you deem the given object needs to be reallocated.
The <code>hasExpired</code> method gets a <code>SlotInfo</code> object, that represents the <code>Poolable</code> being validated, and its <code>Slot</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Your <code>Expiration</code> implementation needs to be thread-safe, since it will be used concurrently by many threads, to validate whatever objects they happen to be trying to claim at any given point in time.
However, only a single thread will be validating any given <code>SlotInfo</code>, and by extension, any given <code>Poolable</code>, at a time.
This means that access to the associated <code>Poolable</code> instance is thread-safe.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>SlotInfo</code> has a number of useful methods for implementing <code>Expiration</code> policies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For instance, the <code>getAgeMillis</code> is used by the <code>TimeExpiration</code> to determine if an object has expired.</p>
</li>
<li>
<p>The <code>setStamp</code> and <code>getStamp</code> methods can store any long your expiration desires.
The stamp of a <code>SlotInfo</code> is always zero for newly allocated objects.
Its value means whatever the expiration policy wants it to mean.
For instance, the <code>TimeSpreadExpiration</code> uses the stamp to store the deadline for when an object will expire.
This way, the number and frequency of claims does not influence the distribution of when objects expire.</p>
</li>
<li>
<p>The <code>randomInt</code> does what it says on the tin.
It returns a random, uniformly distributed int value.
The point of it is, that the random number generator is local to the given <code>SlotInfo</code> instance, and since only a single thread will be accessing a <code>SlotInfo</code> at any given time, the random number generator will be completely free of contention, and therefor very fast.</p>
</li>
<li>
<p>The <code>getClaimCount</code> simply returns the number of times an object has been claimed.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>hasExpired</code> method may be called several times during every call to <code>claim</code>.
It is therefor <em>very</em> critical to the performance of the pool, and you should take great care to make sure that it is fast.
In fact, it is so performance sensitive, that reading the time from the system clock, e.g. with <code>System#currentTimeMillis</code>, can be a significant drag on the performance of the pool.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_background_expiration_checking">Background Expiration Checking</h3>
<div class="paragraph">
<p>Every Stormpot pool starts a background thread to take care of all the allocation and deallocation that needs to happen.
This background thread can also perform expiration checks on the objects in the pool, when it has nothing better to do.
This is off by default, however, since the time it takes to do those checks might interfere with the pools ability to keep up with the demand for allocations and deallocations.
The pool does not know how expensive those expiration checks are.</p>
</div>
<div class="paragraph">
<p>On the other hand, background expiration checks are very useful for applications that may experience periods of low activity, so the objects in the pool don&#8217;t get checked for expiration through the natural traffic to the pool.
The background expiration checks will then make sure that all the objects in the pool are kept fresh, for when the traffic picks up again.
The application would otherwise have found itself with a pool full of expired objects, causing a reallocation storm, and high latencies to claim objects.</p>
</div>
<div class="paragraph">
<p>While background expiration checking is turned off by default, it is recommended to turn it on when the check is something simple, like a <code>TimeExpiration</code> or a <code>TimeSpreadExpiration</code>, or when you are otherwise confident that it won&#8217;t interfere with the pools ability to keep the pool saturated with fresh objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="_allocator_vs_reallocator">Allocator vs Reallocator</h3>
<div class="paragraph">
<p>An <code>Allocator</code> does two things:
It allocates and deallocates objects.
A freshly allocated object is assumed to have a unique object identity among its peers, and once deallocated, is assumed to never appear again.</p>
</div>
<div class="paragraph">
<p>Since objects in the pool tend to live for a relatively long time, but crucially, not forever, it means that the normal operation of the pool will most likely lead to a slow accretion of garbage in the old generation of the heap.
Such garbage can lead to fragmentation and, eventually, an expensive old-generation garbage collection.</p>
</div>
<div class="paragraph">
<p>The <code>Reallocator</code> interface gives integrators an opportunity to counter this.
The <code>Reallocator</code> has a <code>reallocate</code> method, in addition to what it inherits from the <code>Allocator</code> interface.
The <code>reallocate</code> method is a combined deallocate and allocate method.
Since it&#8217;s combined, it can make decisions about whether or not to take the object that it&#8217;s supposed to deallocate, and reuse it for the subsequent allocation.
This way, a <code>Reallocator</code> has the potential to produce old-gen garbage at a much slower rate than an <code>Allocator</code> would.</p>
</div>
<div class="paragraph">
<p>Care must be taken with implementing the <code>Reallocator</code>, though, since the returned object is assumed to be as fresh as any that would have been returned from the <code>allocate</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="metrics-recorder">MetricsRecorder</h3>
<div class="paragraph">
<p>Stormpot has the ability to expose metrics and management handles through JMX.
This is done by registering the pool with an <code>MBeanServer</code>.
Both <code>QueuePool</code> and <code>BlazePool</code> implement the <code>ManagedPool</code> interface for this purpose.
You can read more about how to expose Stormpot through JMX in the <a href="jmx.html">JMX Guide</a>.</p>
</div>
<div class="paragraph">
<p>To expose the metrics, you first have to configure a <code>MetricsRecorder</code>.
No such implementation is configured by default, and in fact, Stormpot doesn&#8217;t even provide a default implementation to begin with.
In other words, you have to implement and integrate a <code>MetricsRecorder</code> yourself.
I recommend that you use Coda Hale&#8217;s <a href="http://metrics.codahale.com/">Metrics</a> library to do this.
Obviously you need to first add this library to your projects list of dependencies, but once you&#8217;ve done that, integrating it is pretty easy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>MetricsRecorder</code> instance you build and configure <em>must</em> be thread-safe.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of what such an integration could look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">stormpot.examples</span>;

<span class="keyword">import</span> <span class="include">com.codahale.metrics.Histogram</span>;
<span class="keyword">import</span> <span class="include">com.codahale.metrics.MetricRegistry</span>;
<span class="keyword">import</span> <span class="include">stormpot.MetricsRecorder</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">CodaHaleMetricsRecorder</span> <span class="directive">implements</span> MetricsRecorder {
  <span class="directive">private</span> <span class="directive">final</span> Histogram allocationLatency;
  <span class="directive">private</span> <span class="directive">final</span> Histogram allocationFailureLatency;
  <span class="directive">private</span> <span class="directive">final</span> Histogram deallocationLatency;
  <span class="directive">private</span> <span class="directive">final</span> Histogram reallocationLatency;
  <span class="directive">private</span> <span class="directive">final</span> Histogram reallocationFailureLatency;
  <span class="directive">private</span> <span class="directive">final</span> Histogram objectLifetime;

  <span class="directive">public</span> CodaHaleMetricsRecorder(<span class="predefined-type">String</span> baseName, MetricRegistry registry) {
    allocationLatency = registry.histogram(baseName + <span class="string"><span class="delimiter">&quot;</span><span class="content">.allocationLatency</span><span class="delimiter">&quot;</span></span>);
    allocationFailureLatency = registry.histogram(baseName + <span class="string"><span class="delimiter">&quot;</span><span class="content">.allocationFailureLatency</span><span class="delimiter">&quot;</span></span>);
    deallocationLatency = registry.histogram(baseName + <span class="string"><span class="delimiter">&quot;</span><span class="content">.deallocationLatency</span><span class="delimiter">&quot;</span></span>);
    reallocationLatency = registry.histogram(baseName + <span class="string"><span class="delimiter">&quot;</span><span class="content">.reallocationLatency</span><span class="delimiter">&quot;</span></span>);
    reallocationFailureLatency = registry.histogram(baseName + <span class="string"><span class="delimiter">&quot;</span><span class="content">.reallocationFailureLatency</span><span class="delimiter">&quot;</span></span>);
    objectLifetime = registry.histogram(baseName + <span class="string"><span class="delimiter">&quot;</span><span class="content">.objectLifetime</span><span class="delimiter">&quot;</span></span>);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> recordAllocationLatencySampleMillis(<span class="type">long</span> milliseconds) {
    allocationLatency.update(milliseconds);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> recordAllocationFailureLatencySampleMillis(<span class="type">long</span> milliseconds) {
    allocationFailureLatency.update(milliseconds);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> recordDeallocationLatencySampleMillis(<span class="type">long</span> milliseconds) {
    deallocationLatency.update(milliseconds);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> recordReallocationLatencySampleMillis(<span class="type">long</span> milliseconds) {
    reallocationLatency.update(milliseconds);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> recordReallocationFailureLatencySampleMillis(<span class="type">long</span> milliseconds) {
    reallocationFailureLatency.update(milliseconds);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> recordObjectLifetimeSampleMillis(<span class="type">long</span> milliseconds) {
    objectLifetime.update(milliseconds);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">double</span> getAllocationLatencyPercentile(<span class="type">double</span> percentile) {
    <span class="keyword">return</span> allocationLatency.getSnapshot().getValue(percentile);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">double</span> getAllocationFailureLatencyPercentile(<span class="type">double</span> percentile) {
    <span class="keyword">return</span> allocationFailureLatency.getSnapshot().getValue(percentile);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">double</span> getDeallocationLatencyPercentile(<span class="type">double</span> percentile) {
    <span class="keyword">return</span> deallocationLatency.getSnapshot().getValue(percentile);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">double</span> getReallocationLatencyPercentile(<span class="type">double</span> percentile) {
    <span class="keyword">return</span> reallocationLatency.getSnapshot().getValue(percentile);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">double</span> getReallocationFailurePercentile(<span class="type">double</span> percentile) {
    <span class="keyword">return</span> reallocationFailureLatency.getSnapshot().getValue(percentile);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">double</span> getObjectLifetimePercentile(<span class="type">double</span> percentile) {
    <span class="keyword">return</span> objectLifetime.getSnapshot().getValue(percentile);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have your <code>MetricsRecorder</code> implementation, you just set an instance of it on your <code>Config</code> object with the <code>setMetricsRecorder</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_threadfactory">ThreadFactory</h3>
<div class="paragraph">
<p>Stormpot creates a background thread per pool instance.
This thread is in charge of allocating and deallocating objects for the pool.
This means that the threads that access the pool to claim objects, don&#8217;t have to pay the overhead of allocating any of the objects themselves.
The latency for claiming objects is thereby reduced, and made more predictable.</p>
</div>
<div class="paragraph">
<p>However, not all platforms and environments let user code create threads willy-nilly.
There might be a <code>SecurityManager</code> that has to approve every thread that is created.
There might be particular contexts, that every new thread needs to be associated with, or bound to, for security purposes.
It might be that you can only create threads if they get associated with a particular <code>ThreadGroup</code>.</p>
</div>
<div class="paragraph">
<p>Whatever the case, if the background thread needs to be created in a particular way for your particular environment, then you can provide a <code>ThreadFactory</code> implementation via the <code>setThreadFactory</code> method, and make sure that the background thread is created in a way that observes the law of the land in your particular circumstances.</p>
</div>
<div class="paragraph">
<p>The default <code>ThreadFactory</code> is based on the <code>Executors.defaultThreadFactory</code>, but also assigns the thread a name, that makes it recognisable as a Stormpot background thread.</p>
</div>
</div>
<div class="sect2">
<h3 id="_precise_leak_detection">Precise Leak Detection</h3>
<div class="paragraph">
<p>Stormpot has precise leak detection enabled by default, because the CPU overhead is very low.
There is, however, a bit of memory overhead.
Therefor, it may make sense to disable this in use cases where memory is very constrained, and/or the pool contains a very large number of objects.
If you pool upwards a hundred thousand objects or more, you might want to disable it for performance reasons.</p>
</div>
<div class="paragraph">
<p>The precise leak detection feature lets Stormpot keep track of when objects that were meant to circulate in the pool, suddenly leak out and never come back.
The number of leaks detected is reported via the <code>getLeakedObjectsCount</code> method of the <code>ManagedPool</code> interface.</p>
</div>
<div class="paragraph">
<p>This feature uses the garbage collector to determine whether or not an object has any chance of ever returning to the pool.
This is why it&#8217;s called <em>precise</em> leak detection:
It never reports any false positives.
That is, it never counts an object as leaked, unless there is a 100% certainty, that it will never, ever return to the pool.
On the other hand, it might not detect all leaks.
For instance, if you claim an object, and then put it in a <code>static final</code> variable and never release it back, then that object will have a strong reference pointing to it, for the lifetime of the class that the <code>static final</code> field.
In this case, there is still a chance that the object may be returned, but if no code actually does this, then it has effectively leaked.
Such a case will not be detected by the precise leak detector.</p>
</div>
<div class="paragraph">
<p>While precise leak detection is able to detect leaks – and a leak is always a bug in user code – it is not able to <em>prevent</em> the leaks.
This means that if a leak has been observed, you know for sure that the shut down process will not terminate.
The shut down process won&#8217;t finish until all allocated objects has been deallocated; which will never happen because leaked objects will remain logically claimed for perpetuity.
In such a case it&#8217;s nice that the API for awaiting on the completion of the shut down process mandates a timeout, so there&#8217;s no waiting forever.</p>
</div>
</div>
<div class="sect2">
<h3 id="_complete_config_source">Complete Config Source</h3>
<div class="paragraph">
<p>For reference, the complete source for the <code>Config</code> class is listed below.
When you instantiate a <code>Pool</code> instance, be it <code>QueuePool</code> or <code>BlazePool</code>, they will take the monitor-lock on the <code>Config</code> instance, thereby preventing it from being modified while they are looking at it.
The pools will then call the <code>validate</code> method to make sure that they have a <code>Config</code> instance that can be used.
Then, they will grab the data they need.
As for the <code>Allocator</code>, the pool instances will get that from the <code>getAdaptedReallocator</code> method.
This helps ensure a uniform recording of some of the metrics, across <code>Pool</code> implementations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*
 * Copyright (C) 2011-2014 Chris Vest (mr.chrisvest@gmail.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>
<span class="keyword">package</span> <span class="namespace">stormpot</span>;

<span class="keyword">import</span> <span class="include">java.util.concurrent.ThreadFactory</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;

<span class="comment">/**
 * = The basic configuration &quot;bean&quot; class.
 *
 * Instances of this class is passed to the constructors of {@link Pool pools}
 * so that they know how big they should be, how to allocate objects and when
 * to deallocate objects.
 *
 * This class is made thread-safe by having the fields be protected by the
 * intrinsic object lock on the Config object itself. This way, pools can
 * `synchronize` on the config object to read the values out
 * atomically.
 *
 * The various set* methods are made to return the Config instance itself, so
 * that the method calls may be chained if so desired.
 *
 * = Standardised configuration
 *
 * The contract of the Config class, and how Pools will interpret it, is within
 * the context of a so-called standardised configuration. All pool and Config
 * implementations must behave similarly in a standardised configuration.
 *
 * It is conceivable that some pool implementations will come with their own
 * sub-classes of Config, that allow greater control over the pools behaviour.
 * It is even permissible that these pool implementations may
 * deviate from the contract of the Pool interface. However, they are only
 * allowed to do so in a non-standard configuration. That is, any deviation
 * from the specified contracts must be explicitly enabled.
 *
 * @author Chris Vest &lt;mr.chrisvest@gmail.com&gt;
 * @param &lt;T&gt; The type of {@link Poolable} objects that a {@link Pool} based
 * on this Config will produce.
 */</span>
<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">unchecked</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Config</span>&lt;T <span class="directive">extends</span> Poolable&gt; <span class="directive">implements</span> <span class="predefined-type">Cloneable</span> {

  <span class="directive">private</span> <span class="type">int</span> size = <span class="integer">10</span>;
  <span class="directive">private</span> Expiration&lt;? <span class="local-variable">super</span> T&gt; expiration =
      <span class="keyword">new</span> TimeSpreadExpiration&lt;T&gt;(<span class="integer">480000</span>, <span class="integer">600000</span>, <span class="predefined-type">TimeUnit</span>.MILLISECONDS); <span class="comment">// 8 to 10 minutes</span>
  <span class="directive">private</span> Allocator&lt;?&gt; allocator;
  <span class="directive">private</span> MetricsRecorder metricsRecorder;
  <span class="directive">private</span> <span class="predefined-type">ThreadFactory</span> threadFactory = StormpotThreadFactory.INSTANCE;
  <span class="directive">private</span> <span class="type">boolean</span> preciseLeakDetectionEnabled = <span class="predefined-constant">true</span>;
  <span class="directive">private</span> <span class="type">boolean</span> backgroundExpirationEnabled = <span class="predefined-constant">false</span>;

  <span class="comment">/**
   * Build a new empty Config object. Most settings have reasonable default
   * values. However, no {@link Allocator} is configured by default, and one
   * must make sure to set one.
   */</span>
  <span class="directive">public</span> Config() {
  }

  <span class="comment">/**
   * Set the size of the pools we want to configure them with. Pools are
   * required to control the allocations and deallocations, such that no more
   * than this number of objects are allocated at any time.
   *
   * This means that a pool of size 1, whose single object have expired, will
   * deallocate that one object before allocating a replacement.
   *
   * The size must be at least one for standard pool configurations. A Pool
   * will throw an {@link IllegalArgumentException} from their constructor if
   * this is not the case.
   * @param size The target pool size. Must be at least 1.
   * @return This Config instance.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Config&lt;T&gt; setSize(<span class="type">int</span> size) {
    <span class="local-variable">this</span>.size = size;
    <span class="keyword">return</span> <span class="local-variable">this</span>;
  }

  <span class="comment">/**
   * Get the currently configured size. Default is 10.
   * @return The configured pool size.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> <span class="type">int</span> getSize() {
    <span class="keyword">return</span> size;
  }

  <span class="comment">/**
   * Set the {@link Allocator} or {@link Reallocator} to use for the pools we
   * want to configure. This will change the type-parameter of the Config
   * object to match that of the new Allocator.
   *
   * The allocator is initially `null` in a new Config object, and can be set
   * to `null` any time. However, in a standard configuration, it must be
   * non-null when the Config is passed to a Pool constructor. Otherwise the
   * constructor will throw an {@link IllegalArgumentException}.
   * @param allocator The allocator we want our pools to use.
   * @param &lt;X&gt; The type of {@link Poolable} that is created by the allocator,
   * and the type of objects that the configured pools will contain.
   * @return This Config instance, but with a generic type parameter that
   * matches that of the allocator.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> &lt;X <span class="directive">extends</span> Poolable&gt; Config&lt;X&gt; setAllocator(
      Allocator&lt;X&gt; allocator) {
    <span class="local-variable">this</span>.allocator = allocator;
    <span class="keyword">return</span> (Config&lt;X&gt;) <span class="local-variable">this</span>;
  }

  <span class="comment">/**
   * Get the configured {@link Allocator} instance. There is no configured
   * allocator by default, so this must be {@link #setAllocator(Allocator) set}
   * before instantiating any Pool implementations from this Config.
   * @return The configured Allocator instance, if any.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Allocator&lt;T&gt; getAllocator() {
    <span class="keyword">return</span> (Allocator&lt;T&gt;) allocator;
  }

  <span class="comment">/**
   * Get the configured {@link stormpot.Allocator} instance as a
   * {@link stormpot.Reallocator}. If the configured allocator implements the
   * Reallocator interface, then it is returned directly. Otherwise, the
   * allocator is wrapped in an adaptor.
   * @return A configured or adapted Reallocator, if any.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Reallocator&lt;T&gt; getReallocator() {
    <span class="keyword">if</span> (allocator == <span class="predefined-constant">null</span>) {
      <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
    <span class="keyword">if</span> (allocator <span class="keyword">instanceof</span> Reallocator) {
      <span class="keyword">return</span> (Reallocator&lt;T&gt;) allocator;
    }
    <span class="keyword">return</span> <span class="keyword">new</span> ReallocatingAdaptor&lt;T&gt;((Allocator&lt;T&gt;) allocator);
  }

  <span class="comment">/**
   * Set the {@link Expiration} to use for the pools we want to
   * configure. The Expiration determines when a pooled object is valid
   * for claiming, or when the objects are invalid and should be deallocated.
   *
   * The default Expiration is a {@link TimeSpreadExpiration} that
   * invalidates the objects after they have been active for somewhere between
   * 8 to 10 minutes.
   * @param expiration The expiration we want our pools to use. Not null.
   * @return This Config instance.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Config&lt;T&gt; setExpiration(Expiration&lt;? <span class="local-variable">super</span> T&gt; expiration) {
    <span class="local-variable">this</span>.expiration = expiration;
    <span class="keyword">return</span> <span class="local-variable">this</span>;
  }

  <span class="comment">/**
   * Get the configured {@link Expiration} instance. The default is a
   * {@link TimeSpreadExpiration} that expires objects after somewhere between
   * 8 to 10 minutes.
   * @return The configured Expiration.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Expiration&lt;? <span class="local-variable">super</span> T&gt; getExpiration() {
    <span class="keyword">return</span> expiration;
  }

  <span class="comment">/**
   * Set the {@link MetricsRecorder} to use for the pools we want to configure.
   * @param metricsRecorder The MetricsRecorder to use, or null if we don't
   *                        want to use any.
   * @return This Config instance.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Config&lt;T&gt; setMetricsRecorder(MetricsRecorder metricsRecorder) {
    <span class="local-variable">this</span>.metricsRecorder = metricsRecorder;
    <span class="keyword">return</span> <span class="local-variable">this</span>;
  }

  <span class="comment">/**
   * Get the configured {@link MetricsRecorder} instance, or null if none has
   * been configured.
   * @return The configured MetricsRecorder.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> MetricsRecorder getMetricsRecorder() {
    <span class="keyword">return</span> metricsRecorder;
  }

  <span class="comment">/**
   * Get the ThreadFactory that has been configured, and will be used to create
   * the background allocation threads for the pools. The default is similar to
   * the {@link java.util.concurrent.Executors#defaultThreadFactory()}, except
   * the string &quot;Stormpot-&quot; is prepended to the thread name.
   * @return The configured thread factory.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> <span class="predefined-type">ThreadFactory</span> getThreadFactory() {
    <span class="keyword">return</span> threadFactory;
  }

  <span class="comment">/**
   * Set the ThreadFactory that the pools will use to create its background
   * threads with. The ThreadFactory is not allowed to be null, and creating
   * a pool with a null ThreadFactory will throw an IllegalArgumentException.
   * @param factory The ThreadFactory the pool should use to create their
   *                background threads.
   * @return This Config instance.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Config&lt;T&gt; setThreadFactory(<span class="predefined-type">ThreadFactory</span> factory) {
    threadFactory = factory;
    <span class="keyword">return</span> <span class="local-variable">this</span>;
  }

  <span class="comment">/**
   * Return whether or not precise object leak detection is enabled, which is
   * the case by default.
   * @return `true` if precise object leak detection is enabled.
   * @see #setPreciseLeakDetectionEnabled(boolean)
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> <span class="type">boolean</span> isPreciseLeakDetectionEnabled() {
    <span class="keyword">return</span> preciseLeakDetectionEnabled;
  }

  <span class="comment">/**
   * Enable or disable precise object leak detection. It is enabled by default.
   * Precise object leak detection makes the pool keep an eye on the allocated
   * Poolables, such that it notices if they get garbage collected without
   * first being deallocated. Using the garbage collector for this purpose,
   * means that no false positives (counting objects as leaked, even though
   * they are not) are ever reported.
   *
   * NOTE: While the pool is able to detect object leaks, it cannot prevent
   * them. All leaks are a sign that there is a bug in the system; most likely
   * a bug in your code, or in the way the pool is used.
   *
   * Precise object leak detection incurs virtually no overhead, and is safe to
   * leave enabled at all times – even in the most demanding production
   * environments.
   *
   * @param enabled `true` to turn on precise object leak detection (the
   *                default) `false` to turn it off.
   * @return This Config instance.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Config&lt;T&gt; setPreciseLeakDetectionEnabled(<span class="type">boolean</span> enabled) {
    <span class="local-variable">this</span>.preciseLeakDetectionEnabled = enabled;
    <span class="keyword">return</span> <span class="local-variable">this</span>;
  }

  <span class="comment">/**
   * Return whether or not background expiration is enabled, which it is not by
   * default.
   * @return `true` if background expiration has been enabled.
   * @see #setBackgroundExpirationEnabled(boolean)
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> <span class="type">boolean</span> isBackgroundExpirationEnabled() {
    <span class="keyword">return</span> backgroundExpirationEnabled;
  }

  <span class="comment">/**
   * Enable or disable background object expiration checking. This is disabled
   * by default, because the pool does not know how expensive this check is.
   * The cost of the check matters because it might end up taking resources
   * away from the background thread and hinder its ability to keep up with the
   * demand for allocations and deallocations, even though these tasks always
   * take priority over any expiration checking.
   *
   * @param enabled `true` to turn background expiration checking on, `false`
   *                (the default) to turn it off.
   * @return This Config instance.
   */</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> Config&lt;T&gt; setBackgroundExpirationEnabled(<span class="type">boolean</span> enabled) {
    backgroundExpirationEnabled = enabled;
    <span class="keyword">return</span> <span class="local-variable">this</span>;
  }

  <span class="comment">/**
   * Returns a shallow copy of this Config object.
   * @return A new Config object of the exact same type as this one, with
   * identical values in all its fields.
   */</span>
  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="directive">final</span> <span class="directive">synchronized</span> Config&lt;T&gt; clone() {
    <span class="keyword">try</span> {
      <span class="keyword">return</span> (Config&lt;T&gt;) <span class="local-variable">super</span>.clone();
    } <span class="keyword">catch</span> (<span class="exception">CloneNotSupportedException</span> e) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">AssertionError</span>(e);
    }
  }

  <span class="comment">/**
   * Check that the configuration is valid in terms of the *standard
   * configuration*. This method is useful in the
   * Pool implementation constructors.
   * @throws IllegalArgumentException If the size is less than one, if the
   * {@link Expiration} is `null`, if the {@link Allocator} is `null`, or if
   * the ThreadFactory is `null`.
   * @deprecated This method will be removed in version 3.0. No alternative is
   * provided, because it is really an internal API.
   */</span>
  <span class="annotation">@Deprecated</span> <span class="comment">// TODO 3.0 make package private</span>
  <span class="directive">public</span> <span class="directive">synchronized</span> <span class="type">void</span> validate() <span class="directive">throws</span> <span class="exception">IllegalArgumentException</span> {
    <span class="keyword">if</span> (size &lt; <span class="integer">1</span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(
          <span class="string"><span class="delimiter">&quot;</span><span class="content">Size must be at least 1, but was </span><span class="delimiter">&quot;</span></span> + size);
    }
    <span class="keyword">if</span> (allocator == <span class="predefined-constant">null</span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Allocator cannot be null</span><span class="delimiter">&quot;</span></span>);
    }
    <span class="keyword">if</span> (expiration == <span class="predefined-constant">null</span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Expiration cannot be null</span><span class="delimiter">&quot;</span></span>);
    }
    <span class="keyword">if</span> (threadFactory == <span class="predefined-constant">null</span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ThreadFactory cannot be null</span><span class="delimiter">&quot;</span></span>);
    }
  }

  <span class="comment">/**
   * Returns `null` if no allocator has been configured.
   * Otherwise returns a `Reallocator`, possibly by adapting the configured
   * `Allocator` if need be.
   * If a `MetricsRecorder` has been configured, the return `Reallocator` will
   * automatically record allocation, reallocation and deallocation latencies.
   */</span>
  Reallocator&lt;T&gt; getAdaptedReallocator() {
    <span class="keyword">if</span> (allocator == <span class="predefined-constant">null</span>) {
      <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
    <span class="keyword">if</span> (metricsRecorder == <span class="predefined-constant">null</span>) {
      <span class="keyword">if</span> (allocator <span class="keyword">instanceof</span> Reallocator) {
        <span class="keyword">return</span> (Reallocator&lt;T&gt;) allocator;
      }
      <span class="keyword">return</span> <span class="keyword">new</span> ReallocatingAdaptor&lt;T&gt;((Allocator&lt;T&gt;) allocator);
    } <span class="keyword">else</span> {
      <span class="keyword">if</span> (allocator <span class="keyword">instanceof</span> Reallocator) {
        <span class="keyword">return</span> <span class="keyword">new</span> TimingReallocatorAdaptor&lt;T&gt;(
            (Reallocator&lt;T&gt;) allocator, metricsRecorder);
      }
      <span class="keyword">return</span> <span class="keyword">new</span> TimingReallocatingAdaptor&lt;T&gt;(
          (Allocator&lt;T&gt;) allocator, metricsRecorder);
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-08-23 01:10:21 CEST
</div>
</div>
</body>
</html>